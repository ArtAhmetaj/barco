# File formats

All file encoding is big-endian.

## Log segment file

The log segment is composed of compressed chunks.

### Chunk

```
+----------+---------------+---------------+----------+
| length   |  start offset | record length | head crc |
| (uint32) |    (uint64)   |    (uint32)   | (int32)  |
+----------+---------------+---------------+----------+
| compressed payload (zstd crc)                       |
| +-------------------------------------------------+ |
| | record                                          | |
| | +------------------------+--------------------+ | |
| | | length (uint32) | timestamp micros (int64)  | | |
| | +------------------------+--------------------+ | |
| | |             body (bytes)                    | | |
| | +---------------------------------------------+ | |
| +-------------------------------------------------+ |
|                                                     |
| +-------------------------------------------------+ |
| | record...                                       | |
| +-------------------------------------------------+ |
|                                                     |
| .                                                   |
| .                                                   |
| .                                                   |
|                                                     |
+-----------------------------------------------------+
| alignment (zeroed bytes)                            |
+-----------------------------------------------------+
```

## Index file

The index file is composed by a series of message offset, file offset and checksum tuples.

```
+--------------------------------------------------------------------+
| items                                                              |
| +----------------------------------------------------------------+ |
| | item                                                           | |
| | +-----------------+----------------------+-------------------+ | |
| | | offset (uint64) | file offset (uint64) | checksum (uint32) | | |
| | +-----------------+----------------------+-------------------+ | |
| +----------------------------------------------------------------+ |
|                                                                    |
| +----------------------------------------------------------------+ |
| | item...                                                        | |
| +----------------------------------------------------------------+ |
|                                                                    |
| .                                                                  |
| .                                                                  |
| .                                                                  |
|                                                                    |
+--------------------------------------------------------------------+
```
